<!--
  cbox api 利用例.
   client/cbox.js
   client/fcipher.js
   client/cbox.css
   client/exsample.html
   これら4つのファイルを、cboxサーバ起動して、cbox/client/に配置させる.
   
   cboxサーバを起動して、
    http://127.0.0.1:3210/client/exsample.html
   
   をブラウザのURLに入れて、実行する.
-->
<!DOCTYPE HTML SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja">
<head>
<meta charset="UTF-8" />

<meta name="description" content="cbox 利用例.">
<meta name="keywords" content="cbox の使い方、理解など.">
<title>cbox exsample.</title>

<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8"/>
<meta http-equiv="content-style-type" content="text/css; charset=utf-8" />
<meta http-equiv="content-script-type" content="text/javascript; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>

<script src="/client/fcipher.js"></script>
<script src="/client/cbox.js"></script>

<link rel="stylesheet" href="/client/exsample.css" type="text/css">

</head>
<body style="background:#000000;color:#ffffff;">

<script>

// デフォルトURLヘッド(http://domain).
var DEF_HEAD_URL = location.protocol + "//" + location.host;

// Elementに割り当てらてたIDでElementを取得.
var $get = function(id) {
  return document.getElementById(id);
}

// input value を削除.
var clearInputValue = function(id) {
  var em = $get(id);
  if(em) {
    em.value = "";
  }
}

// URLを取得.
var getUrl = function(id) {
  var em = $get(id);
  if(em) {
    var v = em.value;
    if(!v || v == "") {
      alert("[" + id + "]のURLが設定されていません");
      throw new Errro("no url error");
    }
    // URLがフルパスの場合はそのまま.
    if(v.indexOf("http://") == 0 || v.indexOf("https://") == 0) {
      return v;
    }
    // 先頭のURLが不正な場合.
    if(v.indexOf("/") != 0) {
      v = "/" + v;
    }
    return DEF_HEAD_URL + v;
  } else {
    alert("[" + id + "]のURLが設定されていません");
    throw new Errro("no url error");
  }
}

// 処理結果のコールバック.
var resultCallback = function(status, result) {
  alert("result(status:" + status + "): " + result);
  return false;
}

// ファイルアップデート.
var sendFileUpdate = function(id, url, result) {
  var em = $get(id);
  if(em.files.length <= 0) {
    alert("[" + id + "] ファイルが指定されていません");
    throw new Errro("no upload file error");
  }
  var files = em.files;
  var file = files[0];

  cbox.updateFile(url, file, result)
}

// データ取得.
var getData = function(id) {
  var em = $get(id);
  if(em) {
    var ret = em.value;
    if(!ret) {
      return "";
    } else {
      return "" + ret;
    }
  } else {
    return "";
  }
}

// 別のタブでURLを開く.
var createTab = function(url) {
  var childWindow = window.open('about:blank');
  childWindow.location.href = url;
  childWindow = null;
}

// localStorage.
var local = (function() {
var l = localStorage ;
var o = {} ;
o.clear = function() {
    l.clear() ;
}
o.put = function( k,v ) {
    l.setItem( k,v ) ;
}
o.get = function( k ) {
    return l.getItem( k ) ;
}
o.remove = function( k ) {
    l.removeItem( k ) ;
}
o.size = function() {
    return l.length ;
}
o.keys = function() {
    var ret = [] ;
    var len = l.length ;
    for( var i = 0 ; i < len ; i ++ ) {
        ret[ret.length] = l[ i ] ;
    }
    return ret ;
}
return o;
})();

// 認証データのロード.
var loadAuthInputValue = function() {
  var authUser = local.get("authUser");
  authUser = (!authUser) ? "" : authUser;
  $get("authUser").value = authUser;

  var authCode = local.get("authCode");
  authCode = (!authCode) ? "" : authCode;
  $get("authCode").value = authCode;

  var authSecurityCode = local.get("authSecurityCode");
  authSecurityCode = (!authSecurityCode) ? "" : authSecurityCode;
  $get("authSecurityCode").value = authSecurityCode; 
}

// アカウント認証用のinputデータを取得.
var _getAuthInputValue = function() {
  var authUser = $get("authUser").value;
  var authCode = $get("authCode").value;
  var authSecurityCode = $get("authSecurityCode").value;

  authUser = (authUser.length == 0) ? "" : authUser;
  authCode = (authCode.length == 0) ? "" : authCode;
  authSecurityCode = (authSecurityCode.length == 0) ? "" : authSecurityCode;

  return [authUser, authCode, authSecurityCode];
}

// 認証データの保存.
var saveAuth = function() {
  var v = _getAuthInputValue();

  local.put("authUser", v[0]);
  local.put("authCode", v[1]);
  local.put("authSecurityCode", v[2]);
}

// 認証データをセット.
var settingAuth = function() {
  var v = _getAuthInputValue();
  cbox.setUAccessAccount(v[0], v[1], v[2]);
}

// 認証データの保存＋登録.
var saveAndSettingAuth = function() {
  saveAuth();
  settingAuth();
}
</script>

<p>
  http://domain の入力を省略すると、現在接続中のcboxにアクセスします.<br>
  また、先頭の / を省略しても / が設定されます.<br>
  <br>
  cboxのルールとしてURLの形式は /ユーザ名/フォルダ名/フォルダ名/ファイル名 のような感じになります.<br>
  ユーザ名配下に「読み込み処理以外」のアクセスに対して、cbox認証が必要となります.<br>
</p>

<br>

<!-- cbox認証情報. -->
<p>
  cbox認証情報 :<br> 
  　ユーザ名　　　　　　: <input type="text" value="" id="authUser" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('authUser')"><br>
  　アカウントコード　　: <input type="text" value="" id="authCode" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('authCode')"><br>
  　セキュリティコード　: <input type="text" value="" id="authSecurityCode" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('authSecurityCode')"><br>
  <input type="button" value="登録・保存" class="base_button" onclick="saveAndSettingAuth()">
</p>

<script>
  // 認証情報をロード.
  loadAuthInputValue();
  settingAuth();
</script>

<br>
<br>

<!-- createFolder -->
<p>
  フォルダ作成 :<br> 
  URL: <input type="text" value="" id="createFolder" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('createFolder')">
  &nbsp;<input type="button" value="createFolder" class="base_button" onclick="cbox.createFolder(getUrl('createFolder'), resultCallback)">
</p>

<br>

<!-- removeFolder -->
<p>
  フォルダ削除 : <br>
  URL: <input type="text" value="" id="removeFolder" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('removeFolder')">
  &nbsp;<input type="button" value="removeFolder" class="base_button" onclick="cbox.removeFolder(getUrl('removeFolder'), resultCallback)">
</p>

<br>

<!-- updateFile -->
<p>
  ファイルアップデート : <br>
  URL: <input type="text" value="" id="updateFolder" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('updateFolder');">
  <br>送信ファイル設定 : <input type="file" value="" id="updateFile" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('updateFile');">
  <br><input type="button" value="updateFile" class="base_button" onclick="sendFileUpdate('updateFile', getUrl('updateFolder'), resultCallback)">
</p>

<br>

<!-- updateFile -->
<p>
  データアップデート : <br>
  URL: <input type="text" value="" id="updateURL" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('updateURL');">
  <br>送信ファイル設定 : <input type="text" value="" id="updateData" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('updateData');">
  <br><input type="button" value="updateData" value="送信" class="base_button" onclick="cbox.updateData(getUrl('updateURL'), getData('updateData'), resultCallback)">
</p>

<br>

<!-- getFile -->
<p>
  ファイル取得 : <br>
  URL: <input type="text" value="" id="getFile" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('getFile')">
  &nbsp;<input type="button" value="ファイルを取得" class="base_button" onclick="createTab(getUrl('getFile'))">
</p>

<br>

<!-- removeFile -->
<p>
  ファイル削除 : <br>
  URL: <input type="text" value="" id="removeFile" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('removeFile')">
  &nbsp;<input type="button" value="ファイルを削除" class="base_button" onclick="cbox.removeFile(getUrl('removeFile'), resultCallback)">
</p>

<br>

<!-- getList -->
<p>
  ファイルリスト取得 : <br>
  URL: <input type="text" value="" id="getList" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('getList')">
  &nbsp;<input type="button" value="リスト取得" class="base_button" onclick="cbox.getList(getUrl('getList'), resultCallback)">
</p>

<br>

<!-- isFile -->
<p>
  ファイル存在チェック : <br>
  URL: <input type="text" value="" id="isFile" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('isFile')">
  &nbsp;<input type="button" value="ファイル存在" class="base_button" onclick="cbox.isFile(getUrl('isFile'), resultCallback)">
</p>

<br>

<!-- isFolder -->
<p>
  フォルダ存在チェック : <br>
  URL: <input type="text" value="" id="isFolder" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('isFolder')">
  &nbsp;<input type="button" value="フォルダ存在" class="base_button" onclick="cbox.isFolder(getUrl('isFolder'), resultCallback)">
</p>

<br>

<!-- isLock -->
<p>
  ロック存在チェック : <br>
  URL: <input type="text" value="" id="isLock" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('isLock')">
  &nbsp;<input type="button" value="ロック存在" class="base_button" onclick="cbox.isLock(getUrl('isLock'), resultCallback)">
</p>

<br>

<!-- forcedLock -->
<p>
  ロック強制解除チェック : <br>
  URL: <input type="text" value="" id="forcedLock" class="base_input_text" max="512" size="50">
  &nbsp;<input type="button" value="クリア" class="base_button" onclick="clearInputValue('forcedLock')">
  &nbsp;<input type="button" value="ロック解除" class="base_button" onclick="cbox.forcedLock(getUrl('forcedLock'), resultCallback)">
</p>

<br>

</body>
</html>